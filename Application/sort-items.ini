[Command]
Name=Sort
Command="
    copyq:
    // When selecting single item, sort the entire tab
    // When selecting multiple items, only sort the selected items

    var date_reverse = {
        [mimeText]: 'Latest First',
        [mimeIcon]: '',
        format: \"application/x-copyq-user-time\",
        reverse: true
    }

    var date = {
        [mimeText]: 'Oldest First',
        [mimeIcon]: '',
        format: \"application/x-copyq-user-time\",
        reverse: false
    }

    var pinned = {
        [mimeText]: 'Pinned to the top',
        [mimeIcon]: '',
        format: \"application/x-copyq-item-pinned\",
        reverse: false
    }

    var alphabet = {
        [mimeText]: 'Alphabetical',
        [mimeIcon]: '',
        format: mimeText,
        reverse: false
    }
    var alphabet_reverse = {
        [mimeText]: 'Alphabetical reverse',
        [mimeIcon]: '',
        format: mimeText,
        reverse: true
    }

    var size_reverse = {
        [mimeText]: 'Biggest First',
        [mimeIcon]: '',
        format: \"ItemSize\",
        reverse: true
    }

    var size = {
        [mimeText]: 'Smallest First',
        [mimeIcon]: '',
        format: \"ItemSize\",
        reverse: false
    }

    // sorting menu list
    var sorts = [
        date_reverse,
        date,
        pinned,
        alphabet,
        alphabet_reverse,
        size_reverse,
        size
    ]
    // Show menu
    var selectedIndex = menuItems(sorts)

    var sel = ItemSelection().current()
    if (sel.length <= 1) {
        if (length() <=1 ) abort()
        // When only one item is selected, the selection is set to the entire tab
        tab(selectedTab())
        sel = ItemSelection().selectAll()
    }

    const rows = sel.rows()
    var order = ''
    if (selectedIndex != -1) {
        // Get the selected sort by
        const selectedFormat = sorts[selectedIndex].format
        switch (selectedFormat) {
            case 'ItemSize':
                // When sorting by item size, it takes ~3ms to calculate the size of each item
                popup('Sorting ⏳', '', rows.length * 3)
                order = sizeList()
                break;
            case \"application/x-copyq-item-pinned\":
                order = sel.itemsFormat(selectedFormat).map((item) => item === undefined);
                break;
            default:
                order = sel.itemsFormat(selectedFormat)
        }
    } else {
        abort()
    }

    // sorting
    if (sorts[selectedIndex].reverse) {
        sel.sort((i, j) => order[i] > order[j]);
    } else {
        sel.sort((i, j) => order[i] < order[j]);
    }
    popup('Sorting completed✅', '', 1000)

    // Obtain the byte size of each item in the sel selection
    function sizeList() {
        var items = sel.items()
        var sizes = []
        for (let row in rows) {
            var itemSize = 0
            var item = items[row]
            for (var format in item) {
                itemSize += read(format, row).size()
            }
            sizes.push(itemSize)
        }
        return sizes
    }"
InMenu=true
Icon=
Shortcut=shift+s