[Command]
Name=Auto preview image or long-text
MatchCommand="
    copyq:
    if (visible()) {
        if (settings('AutoPreview') == 1) {

            if (selectedItems().length > 1) {
                preview(false)
                abort()
            }

            var preview_image = true
            var preview_longText = true

            // The characters count of long-text
            var LongTextCharacters = 100
            // The lines count of long-text
            var LongTextLines = 2

            var format = str(dataFormats())
            var content = str(data(mimeUriList)) || str(data(mimeText))

            icon_on()

            if (condition()) {
                preview(true)
            } else {
                preview(false)
            }
        } else {
            icon_off()
        }
    }
    function condition() {
        return (
            preview_image && (format.match(/image\\/.*/) || content.match(/^file:.*(png|jpe?g|bmp|svg|gif)$/))
            ||
            preview_longText && (content.length > LongTextCharacters || (content.split(/\\n/)).length > LongTextLines)
        )
    }
    function icon_on() {
        menuItem['text'] = 'Auto preview OFF'
        menuItem['icon'] = ''
    }
    function icon_off() {
        menuItem['text'] = 'Auto preview ON'
        menuItem['icon'] = ''
    }"
Command="
    copyq:
    if (str(data(mimeShortcut))=='space') {
        preview(!preview())
        abort()
    }
    var rows = selectedItems()
    if (settings('AutoPreview') == 1) {
        settings('AutoPreview', 0)
        popup('Auto preview❎','',1200)
    } else {
        settings('AutoPreview', 1)
        popup('Auto preview✅','',1200)
    }
    selectItems.apply(this, rows)"
InMenu=true
Icon=
Shortcut=f7, space